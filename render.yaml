services:
  # Service Backend - API Node.js/Express
  - type: web
    name: gestion-etudiant-api
    runtime: docker
    region: oregon
    plan: free
    repo: https://github.com/fiacrednj6313/gestion_des_etudiant.git
    rootDir: backend
    dockerCommand: bun start
    autoDeployTrigger: commit
    envVars:
      - key: PORT
        value: 3000
      - key: NODE_ENV
        value: production
      - key: ORIGIN
        value: https://gestion-etudiant-client.onrender.com
      - key: CREDENTIALS
        value: "true"
      - key: METHODS
        value: GET,HEAD,PUT,PATCH,POST,DELETE
      - key: DATABASE_URL
        fromDatabase:
          name: gestion-etudiant-db
          property: connectionString
      - key: JWT_SECRETS
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 7d
    healthCheckPath: /

  # Service Frontend - React/Vite
  - type: web
    name: gestion-etudiant-client
    runtime: docker
    region: oregon
    plan: free
    repo: https://github.com/fiacrednj6313/gestion_des_etudiant.git
    rootDir: front-react
    autoDeployTrigger: commit
    envVars:
      - key: VITE_API_URL
        fromService:
          name: gestion-etudiant-api
          type: web
          property: hostport
    healthCheckPath: /
    domains:
      - gestion-etudiant.onrender.com

databases:
  # Base de donn√©es PostgreSQL (gratuite)
  - name: gestion-etudiant-db
    databaseName: gestion_etudiant
    plan: free
    region: oregon
    ipAllowList:
      - source: 0.0.0.0/0
        description: allow all connections
